(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-06e4cc76"],{2741:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("loading",{attrs:{active:t.isLoading},on:{"update:active":function(e){t.isLoading=e}}}),0==t.carts.total?a("div",{staticClass:"my-5 container col-lg-6"},[a("div",{staticClass:"h5 text-danger"},[t._v("購物清單中無任何商品")]),a("router-link",{attrs:{to:"/"}},[t._v("返回首頁")])],1):t._e(),0!=t.carts.total?a("div",{staticClass:"my-5 container col-lg-6"},[a("div",{staticClass:"card border-0 shadow-sm"},[t._m(0),a("div",{staticClass:"card-body"},[a("table",{staticClass:"table"},[t._m(1),a("tbody",[t._l(t.carts.carts,(function(e){return a("tr",{key:e.id},[a("td",{staticClass:"align-middle"},[t._v("\n                "+t._s(e.product.title)+"\n                "),e.coupon?a("div",{staticClass:"text-success"},[t._v("已套用優惠券")]):t._e()]),a("td",{staticClass:"align-middle"},[t._v(t._s(e.qty)+" / 件")]),a("td",{staticClass:"align-middle"},[t._v(t._s(t._f("currency")(e.product.price)))]),a("td",{staticClass:"align-middle"},[t._v(t._s(t._f("currency")(e.product.price*e.qty)))]),a("td",{staticClass:"align-middle"},[a("button",{staticClass:"btn btn-outline-danger",on:{click:function(a){return a.preventDefault(),t.removeCartItem(e)}}},[t.status.itemId!==e.id?a("i",{staticClass:"far fa-trash-alt"}):t._e(),t.status.itemId===e.id?a("i",{staticClass:"fas fa-spinner fa-pulse"}):t._e()])])])})),a("tr",{staticClass:"text-primary text-right"},[a("td",{staticClass:"align-middle",attrs:{colspan:"4"}},[a("h5",[t._v("總計："+t._s(t._f("currency")(t.carts.total))+"元")])]),a("td")]),t.carts.total!==t.carts.final_total?a("tr",{staticClass:"text-success text-right"},[a("td",{staticClass:"align-middle",attrs:{colspan:"4"}},[a("h5",[t._v("折扣價："+t._s(t._f("currency")(t.carts.final_total))+"元")])]),a("td")]):t._e()],2)]),a("div",{staticClass:"form-group"},[a("div",{staticClass:"row col-12  align-middle"},[a("div",{staticClass:"align-middle",staticStyle:{"line-height":"24px"}},[t._v("使用優惠代碼：")]),a("div",{staticClass:"custom-control custom-switch"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.coupon_is_enabled,expression:"coupon_is_enabled"}],staticClass:"custom-control-input align-middle",attrs:{type:"checkbox",id:"is_enabled","true-value":1,"false-value":0},domProps:{checked:Array.isArray(t.coupon_is_enabled)?t._i(t.coupon_is_enabled,null)>-1:t._q(t.coupon_is_enabled,1)},on:{change:function(e){var a=t.coupon_is_enabled,s=e.target,o=s.checked?1:0;if(Array.isArray(a)){var r=null,n=t._i(a,r);s.checked?n<0&&(t.coupon_is_enabled=a.concat([r])):n>-1&&(t.coupon_is_enabled=a.slice(0,n).concat(a.slice(n+1)))}else t.coupon_is_enabled=o}}}),a("label",{staticClass:"custom-control-label",attrs:{for:"is_enabled"}})])])]),t.coupon_is_enabled?a("div",{staticClass:"input-group mb-3 col-12"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.coupon,expression:"coupon"}],staticClass:"form-control",attrs:{type:"text",placeholder:"請輸入優惠代碼","aria-label":"","aria-describedby":"button-addon2"},domProps:{value:t.coupon},on:{input:function(e){e.target.composing||(t.coupon=e.target.value)}}}),a("div",{staticClass:"input-group-append"},[a("button",{staticClass:"btn btn-outline-secondary",attrs:{type:"button",id:"button-addon2"},on:{click:function(e){return e.preventDefault(),t.addCouponCode(e)}}},["couponLoading"==t.status.loading?a("i",{staticClass:"fas fa-spinner fa-pulse"}):t._e(),t._v("\n              套用\n            ")])])]):t._e()])])]):t._e(),0!=t.carts.total?a("div",{staticClass:"my-5 container col-lg-6"},[a("div",{staticClass:"card border-0 shadow-sm bg-light"},[t._m(2),a("ValidationObserver",{ref:"observer"},[a("form",{staticClass:"mt-5 pb-3 col-md-12",on:{submit:function(e){return e.preventDefault(),t.creatOrder(e)}}},[a("ValidationProvider",{attrs:{name:"email",rules:"required|email"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.errors;return a("div",{},[a("label",{attrs:{for:"useremail"}},[t._v("Email")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.form.user.email,expression:"form.user.email"}],staticClass:"form-control",attrs:{type:"email",id:"useremail",placeholder:"請輸入Email"},domProps:{value:t.form.user.email},on:{input:function(e){e.target.composing||t.$set(t.form.user,"email",e.target.value)}}}),a("p",{staticClass:"text-danger"},[t._v(t._s(s[0]))])])}}],null,!1,770881413)}),a("ValidationProvider",{attrs:{name:"收件人姓名",rules:"required"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.errors;return a("div",{},[a("label",{attrs:{for:"username"}},[t._v("收件人姓名")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.form.user.name,expression:"form.user.name"}],staticClass:"form-control",attrs:{type:"text",id:"username",placeholder:"請輸入姓名"},domProps:{value:t.form.user.name},on:{input:function(e){e.target.composing||t.$set(t.form.user,"name",e.target.value)}}}),a("p",{staticClass:"text-danger"},[t._v(t._s(s[0]))])])}}],null,!1,2152953678)}),a("ValidationProvider",{attrs:{name:"收件人電話",rules:"required"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.errors;return a("div",{},[a("label",{attrs:{for:"usertel"}},[t._v("收件人電話")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.form.user.tel,expression:"form.user.tel"}],staticClass:"form-control",attrs:{type:"tel",id:"usertel",placeholder:"請輸入電話"},domProps:{value:t.form.user.tel},on:{input:function(e){e.target.composing||t.$set(t.form.user,"tel",e.target.value)}}}),a("p",{staticClass:"text-danger"},[t._v(t._s(s[0]))])])}}],null,!1,809253934)}),a("ValidationProvider",{attrs:{name:"收件人地址",rules:"required"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.errors;return a("div",{},[a("label",{attrs:{for:"useraddress"}},[t._v("收件人地址")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.form.user.address,expression:"form.user.address"}],staticClass:"form-control",attrs:{type:"text",id:"useraddress",placeholder:"請輸入地址"},domProps:{value:t.form.user.address},on:{input:function(e){e.target.composing||t.$set(t.form.user,"address",e.target.value)}}}),a("p",{staticClass:"text-danger"},[t._v(t._s(s[0]))])])}}],null,!1,844864526)}),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"comment"}},[t._v("留言")]),a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.form.message,expression:"form.message"}],staticClass:"form-control",attrs:{name:"",id:"comment",cols:"30",rows:"10"},domProps:{value:t.form.message},on:{input:function(e){e.target.composing||t.$set(t.form,"message",e.target.value)}}})]),a("hr"),a("ValidationProvider",{attrs:{name:"付款方式",rules:"required"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.errors;return a("div",{},[a("div",[t._v("付款方式")]),a("div",{staticClass:"custom-control custom-radio custom-control-inline"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.form.user.payment_method,expression:"form.user.payment_method"}],staticClass:"custom-control-input",attrs:{type:"radio",id:"radio1",value:"刷卡"},domProps:{checked:t._q(t.form.user.payment_method,"刷卡")},on:{change:function(e){return t.$set(t.form.user,"payment_method","刷卡")}}}),a("label",{staticClass:"custom-control-label align-middle",attrs:{for:"radio1"}},[t._v("刷卡")])]),a("div",{staticClass:"custom-control custom-radio custom-control-inline"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.form.user.payment_method,expression:"form.user.payment_method"}],staticClass:"custom-control-input",attrs:{type:"radio",id:"radio2",value:"超商取貨"},domProps:{checked:t._q(t.form.user.payment_method,"超商取貨")},on:{change:function(e){return t.$set(t.form.user,"payment_method","超商取貨")}}}),a("label",{staticClass:"custom-control-label align-middle",attrs:{for:"radio2"}},[t._v("超商取貨")])]),a("div",{staticClass:"custom-control custom-radio custom-control-inline"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.form.user.payment_method,expression:"form.user.payment_method"}],staticClass:"custom-control-input",attrs:{type:"radio",id:"radio3",value:"貨到付款"},domProps:{checked:t._q(t.form.user.payment_method,"貨到付款")},on:{change:function(e){return t.$set(t.form.user,"payment_method","貨到付款")}}}),a("label",{staticClass:"custom-control-label align-middle",attrs:{for:"radio3"}},[t._v("貨到付款")])]),a("p",{staticClass:"text-success"},[t._v("您選擇的付款方式： "+t._s(t.form.user.payment_method)+" ")]),a("p",{staticClass:"text-danger"},[t._v(t._s(s[0]))])])}}],null,!1,3208626540)}),a("div",{staticClass:"text-right"},["orderLoading"!=t.status.loading?a("button",{staticClass:"btn btn-danger"},[t._v("\n              送出訂單\n            ")]):t._e(),"orderLoading"==t.status.loading?a("div",["orderLoading"==t.status.loading?a("i",{staticClass:"fas fa-spinner fa-pulse"}):t._e(),t._v("\n              訂單傳送中\n            ")]):t._e()])],1)])],1)]):t._e()],1)},o=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"pt-3",staticStyle:{height:"25px","background-size":"cover","background-position":"center"}},[a("h5",{staticClass:"text-dark text-center"},[t._v("購物清單")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("thead",[a("td",[t._v("品名")]),a("td",{attrs:{width:"70"}},[t._v("數量")]),a("td",{attrs:{width:"80"}},[t._v("單價")]),a("td",{attrs:{width:"80"}},[t._v("小計")]),a("td",{attrs:{width:"50"}})])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"pt-3",staticStyle:{height:"25px","background-size":"cover","background-position":"center"}},[a("h5",{staticClass:"text-dark text-center"},[t._v("訂購人資訊")])])}],r=(a("7f7f"),a("96cf"),a("3b8d")),n=(a("ac6a"),a("7bb1")),i={components:{ValidationProvider:n["b"],ValidationObserver:n["a"]},data:function(){return{isLoading:!1,status:{itemId:"",cartId:"",loading:""},carts:{},coupon:"",coupon_is_enabled:"",form:{user:{name:"",email:"",tel:"",address:"",payment_method:""},message:"",cartArrayToLS:[]},user:{username:"joseph.work01@gmail.com",password:"Jcw0122456"}}},methods:{getCart:function(){var t="".concat("https://vue-course-api.hexschool.io","/api/").concat("joseph_work01","/cart"),e=this;e.isLoading=!0,this.$http.get(t).then((function(t){console.log("getCart",t.data.data),e.carts=t.data.data,e.isLoading=!1}))},removeCartItem:function(t){var e=this,a=t.id,s="".concat("https://vue-course-api.hexschool.io","/api/").concat("joseph_work01","/cart/").concat(a),o=this;o.status.itemId=t.id,this.$http.delete(s).then((function(a){console.log(a.data,t),a.data.success?o.$bus.$emit("message:push","".concat(a.data.message," ").concat(t.product.title," 商品"),"success"):o.$bus.$emit("message:push",a.data.message,"danger"),e.getCart(),o.status.itemId=""}))},removeAllCartItem:function(){var t=this,e=this;e.isLoading=!0,e.carts.carts.forEach((function(a){var s=a.id,o="".concat("https://vue-course-api.hexschool.io","/api/").concat("joseph_work01","/cart/").concat(s);t.$http.delete(o).then((function(t){console.log(t.data),t.data.success?console.log("Cart已全刪除"):console.log("Cart全刪除失敗"),e.isLoading=!1}))}))},addCouponCode:function(){var t=this,e="".concat("https://vue-course-api.hexschool.io","/api/").concat("joseph_work01","/coupon"),a=this,s={code:a.coupon};a.status.loading="couponLoading",this.$http.post(e,{data:s}).then((function(e){console.log("套用優惠券",e.data),e.data.success?a.$bus.$emit("message:push",e.data.message,"success"):(a.coupon_is_enabled=!1,a.$bus.$emit("message:push",e.data.message,"danger")),t.getCart(),a.status.loading=""}))},creatOrder:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e,a,s,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e="".concat("https://vue-course-api.hexschool.io","/api/").concat("joseph_work01","/order"),a=this,s=a.form,a.status.loading="orderLoading",t.next=6,this.$refs.observer.validate();case 6:o=t.sent,o?a.$http.post(e,{data:s}).then((function(t){console.log("訂單完成",t),t.data.success?(a.updateStock(),a.$router.push("/order-check/".concat(t.data.orderId))):a.$bus.$emit("message:push",t.data.message,"danger"),a.status.loading=""})):(a.$bus.$emit("message:push","表單填寫不完整","danger"),a.status.loading="");case 8:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),updateStock:function(){var t=this,e=[],a="".concat("https://vue-course-api.hexschool.io","/admin/signin");t.isLoading=!0,this.$http.post(a,t.user).then((function(a){console.log(a.data),a.data.success?(console.log("登入成功"),t.carts.carts.forEach((function(a){var s="".concat("https://vue-course-api.hexschool.io","/api/").concat("joseph_work01","/product/").concat(a.product_id);t.$http.get(s).then((function(s){if(s.data.success){console.log("getProduct",s.data),e=s.data.product,e.stock=a.product.stock-a.qty,console.log("newProduct",e,"stock",e.stock);var o="".concat("https://vue-course-api.hexschool.io","/api/").concat("joseph_work01","/admin/product/").concat(a.product_id);t.$http.put(o,{data:e}).then((function(e){console.log("putProduct",e.data),e.data.success?(console.log("庫存量更新成功"),t.isLoading=!1):(console.log("庫存量更新錯誤"),t.isLoading=!1)}))}else console.log("產品資料讀入錯誤"),t.isLoading=!1}))}))):(console.log("登入失敗",a.data.error.message),t.isLoading=!1)}))}},created:function(){this.getCart()},mounted:function(){},beforeDestroy:function(){},beforeRouteLeave:function(t,e,a){if(0===this.carts.total)a();else if("OrderCheck"===t.name)a();else{var s=confirm("訂單尚未建立，\n離開此頁面將遺失商品資訊！");s?(this.removeAllCartItem(),a()):a(!1)}}},c=i,l=a("2877"),d=Object(l["a"])(c,s,o,!1,null,null,null);e["default"]=d.exports},"7f7f":function(t,e,a){var s=a("86cc").f,o=Function.prototype,r=/^\s*function ([^ (]*)/,n="name";n in o||a("9e1e")&&s(o,n,{configurable:!0,get:function(){try{return(""+this).match(r)[1]}catch(t){return""}}})}}]);
//# sourceMappingURL=chunk-06e4cc76.31035672.js.map